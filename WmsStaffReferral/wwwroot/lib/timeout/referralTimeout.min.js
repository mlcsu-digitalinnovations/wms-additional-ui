!function (i, n) { "use strict"; i.widget("ab.dialog", i.ui.dialog, { options: { icon: !1 }, _create: function () { if (this._super(), this.options.icon) { var n = "ui-dialog-icon ui-icon " + this.options.icon; this.uiDialog.find(".ui-dialog-titlebar").prepend(i("<span/>").addClass(n)) } i(".ui-dialog-buttonset button:Contains('Continue')").removeClass("ui-button ui-corner ui-widget").addClass("nhsuk-button"), i(".ui-dialog-buttonset button:Contains('End Session')").removeClass("ui-button ui-corner ui-widget").addClass("nhsuk-button nhsuk-button--secondary") } }), i.fn.referralTimeout = function (o) { var t, e, s, u, a, d, $, c, l, r, f = i.extend({ idleNotification: 3e5, sessionRemaining: 3e5 }, o), g = 0, m = function (i) { var n = Math.floor(i / 60); return i -= 60 * n, (n < 10 ? "0" + n : n) + ":" + (i < 10 ? "0" + i : i) }, h = function (i) { clearTimeout(t), d = 0, u = new Date().getTime(), t = setTimeout(function () { p(i) }, 100) }, _ = function (i) { clearTimeout(e), $ = 0, c = 0, a = new Date().getTime(), s = Math.floor((f.sessionRemaining - g) / 1e3), e = setTimeout(function () { b(i) }, 100) }, b = function (n) { $ += 100, r = new Date().getTime() - a - $, $ >= f.sessionRemaining - g ? v("endsession") : (1e3 === (c += 100) && 0 !== s && (s -= 1, i("#sessioncountdown").html(m(s)), c = 0), e = setTimeout(function () { b(n) }, 100 - r)) }, p = function (i) { d += 100, l = new Date().getTime() - u - d; var n = new Date().getTime() - u; n >= f.idleNotification + f.sessionRemaining && v("endsession"), d === f.idleNotification ? (n -= 1e3, g = n > d ? n - d : 0, w()) : t = setTimeout(function () { p(i) }, 100 - l) }, w = function () { _("DialogTimer"), i('<div id="notifyLogout"><p>For your security your session will end in <span id="sessioncountdown">' + s + "</span> due to inactivity. Select End Session to end it now otherwise select Continue to stay logged in.</p></div>").dialog({ title: "Session Timeout", classes: { "ui-dialog": "no-close" }, modal: !0, width: "auto", maxWidth: 300, height: "auto", fluid: !0, resizable: !1, buttons: { Continue: function () { i.ajax({ url: "/staffReferral/session-ping", context: document.body }), i(this).dialog("close"), i(this).empty(), i(this).remove(), clearTimeout(e), h("IdleTimer") }, "End Session": function () { v() } } }) }, v = function (i) { clearTimeout(t), clearTimeout(e); var o = "/session/sign-out"; return "endsession" === i && (o = "/session/session-ended"), n.location.replace(o) }; return this.each(function () { h("IdleTimer") }) } }(jQuery, window);